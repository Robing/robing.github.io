<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: HTML5 | Rainer's blog]]></title>
  <link href="http://Robing.github.io/blog/categories/html5/atom.xml" rel="self"/>
  <link href="http://Robing.github.io/"/>
  <updated>2014-06-05T09:55:20+08:00</updated>
  <id>http://Robing.github.io/</id>
  <author>
    <name><![CDATA[Robin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Using Web Notifications]]></title>
    <link href="http://Robing.github.io/blog/2014/06/03/using-web-notifications/"/>
    <updated>2014-06-03T16:46:58+08:00</updated>
    <id>http://Robing.github.io/blog/2014/06/03/using-web-notifications</id>
    <content type="html"><![CDATA[<div id="wiki-content" class="column-main wiki-column text-content">
    <!-- just the article content -->
    <article id="wikiArticle">
        <h2 id="Summary">Summary</h2>
        <p>The Web Notifications API allows a web page to send notifications that are displayed outside the page at the system level. This allows web apps to send information to a user even if the application is idle. One of the main obvious use cases is a webmail application that would notify the user each time a new e-mail is received, even if the user is doing something else with another application.</p>
        <p>To display notification you need to first request the appropriate permission and then instantiate a
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification" title="The Notification object is used to configure and display desktop notifications to the user.">Notification</a>
            object:</p>
        <pre class="brush: js  language-js" data-number=""><code class=" language-js">Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span> <span class="token keyword">function</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // notifications will only be displayed if "granted"
</span>  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>body<span class="token punctuation">:</span> <span class="token string">"notification body"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // this also shows the notification
</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div></code></pre>
        <h2 id="Requesting_permission">Requesting permission</h2>
        <h3 id="Web_content">Web content</h3>
        <p>Before an app is able to send a notification, the user must grant the application the right to do so. This is a common requirement when an API tries to interact with something outside a web page. This guarantees to avoid notification "spam" for the well-being of the user.</p>
        <p>An application that needs to send a notification can check the current permission status thanks to the
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.permission" title="The permission property indicates the current permission granted by the user about web notification for the current application.">Notification.permission</a>read only property. It can have one of three possible values:</p>
        <ul class="txtlist">
            <li>default: the user didn't give any permission yet (and therefore no notification will be displayed to the user).</li>
            <li>granted: the user explicitly accepted to be notified by the application.</li>
            <li>denied: the user explicitly refused to be notified by the application.</li>
        </ul>
        <div class="note">
            <p><strong>Note:</strong>Chrome and Safari do not implement thepermissionproperty yet.</p>
        </div>
        <p>If the permission is not granted, the application has to use the<a href="http://Robing.github.io/en-US/docs/Web/API/Notification.requestPermission" title="The requestPermission static method is used to ask the user for his permission to display a Notification to him.">Notification.requestPermission()</a>method to let the user make a choice. This method accepts a callback function that receives the permission chosen by the user in order to react to it.</p>
        <p>It's a common practice to ask for the permission at the initialization of the app:</p>
        <pre class="brush: js  language-js" data-number=""><code class=" language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // This allows to use Notification.permission with Chrome/Safari
</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Notification<span class="token punctuation">.</span>permission <span class="token operator">=</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div></code></pre>
        <div class="note">
            <p>
                <strong>Note:</strong>Chrome does not allows to call
                <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.requestPermission" title="The requestPermission static method is used to ask the user for his permission to display a Notification to him.">Notification.requestPermission()</a>on theloadevent (see <a class="external external-icon" href="https://code.google.com/p/chromium/issues/detail?id=274284" title="https://code.google.com/p/chromium/issues/detail?id=274284">issue 274284</a>).</p>
        </div>
        <h3 id="Installed_application">Installed application</h3>
        <p>When an application is installed, it's possible to avoid to prompt the user for permission by adding the permission directly within the <a href="http://Robing.github.io/en-US/docs/Web/Apps/Manifest" title="/en-US/docs/Web/Apps/Manifest">application manifest</a>:</p>
        <pre class="brush: json  language-json" data-number=""><code class=" language-json"><span class="token key">"permissions":</span> <span class="token punctuation">{</span>
  <span class="token key">"desktop-notification":</span> <span class="token punctuation">{</span>
    <span class="token key">"description":</span> <span class="token string">"Allows to display notifications on the user's desktop."</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div></code></pre>
        <h2 id="Creating_a_notification">Creating a notification</h2>
        <p>Creating a notification is simply done using the
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification" title="The Notification object is used to configure and display desktop notifications to the user.">Notification</a>constructor. This constructor expects a title to display within the notification and some options to enhance the notification such as an
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.icon" title="The icon property indicates the URL of the icon to use with the notification.">icon</a>or a text
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.body" title="The body property represents the text content of the body of the notification.">body</a>.</p>
        <p>A notification is displayed as soon as possible when instantiated. To track the current state of a notification, four events are triggered at the
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification" title="The Notification object is used to configure and display desktop notifications to the user.">Notification</a>instance level:</p>
        <ul class="txtlist">
            <li><a href="http://Robing.github.io/en-US/docs/Web/Reference/Events/show" title="/en-US/docs/Web/Reference/Events/show">show</a>: triggered when the notification is displayed to the user.</li>
            <li><a href="http://Robing.github.io/en-US/docs/Web/Reference/Events/click" title="/en-US/docs/Web/Reference/Events/click">click</a></: triggered when the user clicks on the notification.</li>
            <li><a class="new" href="http://Robing.github.io/en-US/docs/Web/Reference/Events/close" title="/en-US/docs/Web/Reference/Events/close">close</a>: triggered when the notification is closed.</li>
            <li><a href="http://Robing.github.io/en-US/docs/Web/Reference/Events/error" title="/en-US/docs/Web/Reference/Events/error">error</a>: triggered when something wrong happens with the notification (mostly when something prevents the notification from being displayed)</li>
        </ul>
        <p>Those events can be tracked using the event handlers
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.onshow" title="Specifies an event listener to receive show events. These events occur when a Notification is displayed."><code>onshow</code></a>,
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.onclick" title="Specifies an event listener to receive click events. These events occur when the user clicks on a displayed Notification."><code>onclick</code></a>,
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.onclose" title="Specifies an event listener to receive close events. These events occur when a Notification is closed."><code>onclose</code></a>, or
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.onerror" title="Specifies an event listener to receive error events. These events occur when something goes wrong with a Notification (in many cases an error prevented the notification from being displayed)."><code>onerror</code></a>. Because
            <a href="http://Robing.github.io/en-US/docs/Web/API/Notification" title="The Notification object is used to configure and display desktop notifications to the user."><code>Notification</code></a>also inherits from
            <a href="http://Robing.github.io/en-US/docs/Web/API/EventTarget" title="EventTarget is a DOM interface implemented by objects that can receive DOM events and have listeners for them."><code>EventTarget</code></a>, it's possible to use the
            <a href="http://Robing.github.io/en-US/docs/Web/API/EventTarget.addEventListener" title="The EventTarget.addEventListener() method registers the specified listener on the EventTarget it's called on. The event target may be an Element in a document, the Document itself, a Window, or any other object that supports events (such as XMLHttpRequest)."><code>addEventListener()</code></a>method.</p>
        <div class="note">
            <p>
                <strong>Note:</strong>Firefox and Safari close the notifications automatically after a few moments, e.g. 4&nbsp; seconds.</p>
            <p>This can also be done at the web application level using the
                <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.close" title="The close method is used to close a Notification that has been displayed."><code>Notification.close()</code></a>method, for example with the following code:</p>
            <pre class="brush: js  language-js" data-number=""><code class=" language-js"><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
n<span class="token punctuation">.</span>onshow <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token function">setTimeout<span class="token punctuation">(</span></span>n<span class="token punctuation">.</span>close<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div></code></pre>
            <p>When you receive a "close" event, there is no guarantee that it's the user who closed the notification. This is in line with the specification, which states: "When a notification is closed, either by the underlying notifications platform or by the user, the close steps for it must be run."</p>
        </div>
        <h3 id="Simple_example">Simple example</h3>
        <p>Assume the following basic HTML:</p>
        <pre class="brush: html  language-html" data-number=""><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Notify me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><div class="line-number" data-start="1" style="top: 0px;"></div></code></pre>
        <p>It's possible to handle notifications this way:</p>
        <pre class="brush: js  language-js" data-number=""><code class=" language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // At first, let's check if we have permission for notification
</span> <span class="token comment" spellcheck="true"> // If not, let's ask for it
</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Notification<span class="token punctuation">.</span>permission <span class="token operator">=</span> status<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName<span class="token punctuation">(</span></span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  button<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // If the user agreed to get notified
</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true"> // If the user hasn't told if he wants to be notified or not
</span>   <span class="token comment" spellcheck="true"> // Note: because of Chrome, we are not sure the permission property
</span>   <span class="token comment" spellcheck="true"> // is set, therefore it's unsafe to check for the "default" value.
</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">"denied"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Notification<span class="token punctuation">.</span>permission <span class="token operator">=</span> status<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

       <span class="token comment" spellcheck="true"> // If the user said okay
</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

       <span class="token comment" spellcheck="true"> // Otherwise, we can fallback to a regular modal alert
</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true"> // If the user refuses to get notified
</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true"> // We can fallback to a regular modal alert
</span>      <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div><div class="line-number" data-start="38" style="top: 703px;"></div><div class="line-number" data-start="39" style="top: 722px;"></div><div class="line-number" data-start="40" style="top: 741px;"></div><div class="line-number" data-start="41" style="top: 760px;"></div><div class="line-number" data-start="42" style="top: 779px;"></div><div class="line-number" data-start="43" style="top: 798px;"></div><div class="line-number" data-start="44" style="top: 817px;"></div><div class="line-number" data-start="45" style="top: 836px;"></div><div class="line-number" data-start="46" style="top: 855px;"></div><div class="line-number" data-start="47" style="top: 874px;"></div></code></pre>
        <p>And the live result:</p>
        <p>
            <iframe class="live-sample-frame" frameborder="0" height="30" src="https://mdn.mozillademos.org/en-US/docs/WebAPI/Using_Web_Notifications$samples/Simple_example?revision=561527" width="100%"></iframe>
        </p>
        <h2 id="Dealing_with_repeated_notifications">Dealing with repeated notifications</h2>
        <p>In some cases it can be painful for the user to send him a high number of notifications--for example, if an application for instant messaging can notify a user for each incoming message. To avoid bloating the user desktop with hundreds of unnecessary notifications, it's possible to take over the queue of pending notifications.</p>
        <p>To do this, it's possible to add a tag to any new notification. If a notification already has the same tag and has not been displayed yet, the new notification will replace that previous notification. If the notification with the same tag has been already displayed, the previous notification is closed and the new one is displayed.</p>
        <h3 id="Tag_example">Tag example</h3>
        <p>Assume the following basic HTML:</p>
        <pre class="brush: html  language-html" data-number=""><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Notify me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><div class="line-number" data-start="1" style="top: 0px;"></div></code></pre>
        <p>It's possible to handle multiple notifications this way:</p>
        <pre class="brush: js  language-js" data-number=""><code class=" language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // At first, let's check if we have permission for notification
</span> <span class="token comment" spellcheck="true"> // If not, let's ask for it
</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Notification<span class="token punctuation">.</span>permission <span class="token operator">=</span> status<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName<span class="token punctuation">(</span></span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  button<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // If the user agreed to get notified
</span>   <span class="token comment" spellcheck="true"> // Let's try to send ten notifications
</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true"> // Thanks to the tag, we should only see the "Hi! 9" notification
</span>        <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"Hi! "</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token punctuation">{</span>tag<span class="token punctuation">:</span> <span class="token string">'soManyNotification'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true"> // If the user hasn't told if he wants to be notified or not
</span>   <span class="token comment" spellcheck="true"> // Note: because of Chrome, we are not sure the permission property
</span>   <span class="token comment" spellcheck="true"> // is set, therefore it's unsafe to check for the "default" value.
</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">"denied"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Notification<span class="token punctuation">.</span><span class="token function">requestPermission<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">!</span><span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Notification<span class="token punctuation">.</span>permission <span class="token operator">=</span> status<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

       <span class="token comment" spellcheck="true"> // If the user said okay
</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"granted"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment" spellcheck="true"> // Thanks to the tag, we should only see the "Hi! 9" notification
</span>            <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"Hi! "</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token punctuation">{</span>tag<span class="token punctuation">:</span> <span class="token string">'soManyNotification'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

       <span class="token comment" spellcheck="true"> // Otherwise, we can fallback to a regular modal alert
</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true"> // If the user refuses to get notified
</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true"> // We can fallback to a regular modal alert
</span>      <span class="token function">alert<span class="token punctuation">(</span></span><span class="token string">"Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-number" data-start="1" style="top: 0px;"></div><div class="line-number" data-start="2" style="top: 19px;"></div><div class="line-number" data-start="3" style="top: 38px;"></div><div class="line-number" data-start="4" style="top: 57px;"></div><div class="line-number" data-start="5" style="top: 76px;"></div><div class="line-number" data-start="6" style="top: 95px;"></div><div class="line-number" data-start="7" style="top: 114px;"></div><div class="line-number" data-start="8" style="top: 133px;"></div><div class="line-number" data-start="9" style="top: 152px;"></div><div class="line-number" data-start="10" style="top: 171px;"></div><div class="line-number" data-start="11" style="top: 190px;"></div><div class="line-number" data-start="12" style="top: 209px;"></div><div class="line-number" data-start="13" style="top: 228px;"></div><div class="line-number" data-start="14" style="top: 247px;"></div><div class="line-number" data-start="15" style="top: 266px;"></div><div class="line-number" data-start="16" style="top: 285px;"></div><div class="line-number" data-start="17" style="top: 304px;"></div><div class="line-number" data-start="18" style="top: 323px;"></div><div class="line-number" data-start="19" style="top: 342px;"></div><div class="line-number" data-start="20" style="top: 361px;"></div><div class="line-number" data-start="21" style="top: 380px;"></div><div class="line-number" data-start="22" style="top: 399px;"></div><div class="line-number" data-start="23" style="top: 418px;"></div><div class="line-number" data-start="24" style="top: 437px;"></div><div class="line-number" data-start="25" style="top: 456px;"></div><div class="line-number" data-start="26" style="top: 475px;"></div><div class="line-number" data-start="27" style="top: 494px;"></div><div class="line-number" data-start="28" style="top: 513px;"></div><div class="line-number" data-start="29" style="top: 532px;"></div><div class="line-number" data-start="30" style="top: 551px;"></div><div class="line-number" data-start="31" style="top: 570px;"></div><div class="line-number" data-start="32" style="top: 589px;"></div><div class="line-number" data-start="33" style="top: 608px;"></div><div class="line-number" data-start="34" style="top: 627px;"></div><div class="line-number" data-start="35" style="top: 646px;"></div><div class="line-number" data-start="36" style="top: 665px;"></div><div class="line-number" data-start="37" style="top: 684px;"></div><div class="line-number" data-start="38" style="top: 703px;"></div><div class="line-number" data-start="39" style="top: 722px;"></div><div class="line-number" data-start="40" style="top: 741px;"></div><div class="line-number" data-start="41" style="top: 760px;"></div><div class="line-number" data-start="42" style="top: 779px;"></div><div class="line-number" data-start="43" style="top: 798px;"></div><div class="line-number" data-start="44" style="top: 817px;"></div><div class="line-number" data-start="45" style="top: 836px;"></div><div class="line-number" data-start="46" style="top: 855px;"></div><div class="line-number" data-start="47" style="top: 874px;"></div><div class="line-number" data-start="48" style="top: 893px;"></div><div class="line-number" data-start="49" style="top: 912px;"></div><div class="line-number" data-start="50" style="top: 931px;"></div><div class="line-number" data-start="51" style="top: 950px;"></div><div class="line-number" data-start="52" style="top: 969px;"></div><div class="line-number" data-start="53" style="top: 988px;"></div><div class="line-number" data-start="54" style="top: 1007px;"></div></code></pre>
        <p>And the live result:</p>
        <p>
            <iframe class="live-sample-frame" frameborder="0" height="30" src="https://mdn.mozillademos.org/en-US/docs/WebAPI/Using_Web_Notifications$samples/Tag_example?revision=561527" width="100%"></iframe>
        </p>

        <h3 id="Gecko_notes">Gecko notes</h3>
        <ul class="txtlist">
            <li>Prior to Firefox 22 (Firefox OS &lt;1.2), the instantiation of a new notification must be done with the
                <a href="http://Robing.github.io/en-US/docs/Web/API/window.navigator.mozNotification" title="Provides support for creating notification objects, which are used to display desktop notification alerts to the user. Currently, these are only supported on Firefox Mobile and Firefox OS. See Displaying notifications for an example."><code>navigator.mozNotification</code></a>object through its<code>createNotification</code>method.</li>
            <li>Prior to Firefox 22 (Firefox OS &lt;1.2), the Notification was displayed when calling the<code>show</code>method and was supporting the<code>click</code>and<code>close</code>events only.</li>
            <li>Nick Desaulniers has written a <a class="external external-icon" href="https://github.com/nickdesaulniers/fxos-irc/blob/master/js/notification.js">Notification shim</a> to cover both newer and older implementations.</li>
            <li>One particular Firefox OS issue is that you can <a class="external external-icon" href="https://github.com/nickdesaulniers/fxos-irc/blob/0160cf6c3a2b5c9fe33822aaf6bcba3b7e846da9/my.js#L171">pass a path to an icon</a> to use in the notification, but if the app is packaged you cannot use a relative path like<code>/my_icon.png</code>. You also can't use<code>window.location.origin + "/my_icon.png"</code>because<code>window.location.origin</code>is null in packaged apps. The <a href="https://developer.mozilla.org/en-US/Apps/Developing/Manifest#origin">manifest origin field</a> fixes this, but it is only available in Firefox OS 1.1+. A potential solution for supporting Firefox OS &lt;1.1 is to <a class="external external-icon" href="https://github.com/nickdesaulniers/fxos-irc/blob/0160cf6c3a2b5c9fe33822aaf6bcba3b7e846da9/my.js#L168">pass an absolute URL to an externally hosted version of the icon</a>. This is less than ideal as the notification is displayed immediately with the icon missing, then the icon is fetched, but it works on all versions of Firefox OS.</li>
        </ul>
        <h3 id="Chrome_notes">Chrome notes</h3>
       <ul class="txtlist">
            <li>Prior to Chrome 22, the support for notification was following an <a class="external external-icon" href="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification" title="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification">old prefixed version of the specification</a> and was using the
                <a class="new" href="http://Robing.github.io/en-US/docs/Web/API/window.navigator.webkitNotifications" title="The documentation about this has not yet been written; please consider contributing!"><code>navigator.webkitNotifications</code></a>object to instantiate a new notification.</li>
            <li>Prior to Chrome 32,
                <a href="http://Robing.github.io/en-US/docs/Web/API/Notification.permission" title="The permission property indicates the current permission granted by the user about web notification for the current application."><code>Notification.permission</code></a>was not supported.</li>
        </ul>
        <h3 id="Safari_notes">Safari notes</h3>
        <ul class="txtlist">
            <li>Safari started supporting notification with Safari 6 but only on Mac OSX 10.8+ (Mountain Lion).</li>
        </ul>
        
    </article>


    <!-- attachments list -->
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shadow DOM 301]]></title>
    <link href="http://Robing.github.io/blog/2014/05/16/shadow-dom-301/"/>
    <updated>2014-05-16T12:21:36+08:00</updated>
    <id>http://Robing.github.io/blog/2014/05/16/shadow-dom-301</id>
    <content type="html"><![CDATA[<div class="content" id="article-content">
<p>This article discusses more of the amazing things you can do with Shadow DOM! It builds on the concepts discussed in <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom/">Shadow DOM 101</a>
and <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-201/">Shadow DOM 201</a>.</p>
<p class="tip notice">In Chrome, turn on the "Enable experimental Web Platform features" in about:flags to experiment with everything covered in this article.</p>

<h2 id="toc-shadow-multiple">Using multiple shadow roots</h2>

<p>If you're hosting a party, it gets stuffy if everyone is crammed into the same room.
You want the option of distributing groups of people across multiple rooms. Elements hosting
Shadow DOM can do this too, that is to say, they can host more than one shadow
root at a time.</p>
<p>Let's see what happens if we try to attach multiple shadow roots to a host:</p>
<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"example1"</span><span class="tag">&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#example1'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root1 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root2 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root1</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div&gt;Root 1 FTW&lt;/div&gt;'</span><span class="pun">;</span><span class="pln">
root2</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div&gt;Root 2 FTW&lt;/div&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<div class="demodevtools"> 
<img src="http://rainer.qiniudn.com/stacking.png" title="Attaching multiple shadow trees" alt="Attaching multiple shadow trees" style="width:250px;">
</div>

<div class="demoarea">
  <div id="example1">Light DOM</div>
</div>

<script>
(function() {
var container = document.querySelector('#example1');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
root1.innerHTML = '<div>Root 1 FTW</div>';
root2.innerHTML = '<div>Root 2 FTW</div>';
})();
</script>

<p class="notice tip">In the DevTools, turn on "Show Shadow DOM" to be
  able to inspect ShadowRoots.</p>

<p>What renders is "Root 2 FTW", despite the fact that we had already attached a shadow tree.
This is because the last shadow tree added to a host, wins. It's a LIFO stack as
far as rendering is concerned. Examining the DevTools verifies this behavior.</p>
<p class="notice fact">Shadow trees added to a host are stacked in the order they're added,
starting with the most recent first. The last one added is the one that renders.</p>

<blockquote class="commentary talkinghead" id="youngest-tree">
The most recently added tree is called the <b>younger tree</b>. Previous trees are called <b>older trees</b>. In this example, <code>root2</code> is the younger tree and  <code>root1</code> is the older tree.
</blockquote>

<p>So what's the point of using multiple shadows if only the last is invited to the
rendering party? Enter shadow insertion points.</p>
<h3 id="toc-shadow-insertion">Shadow Insertion Points</h3>

<!-- more -->

<p>"Shadow insertion points" (<code>&lt;shadow&gt;</code>) are similar to normal <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom/#toc-separation-separate">insertion points</a> (<code>&lt;content&gt;</code>) in that they're placeholders. However, instead of being placeholders for a host's <em>content</em>, they're hosts for other <em>shadow trees</em>.
It's Shadow DOM Inception!</p>
<p>As you can probably imagine, things get more complicated the further you drill down
the rabbit hole. For this reason, the spec is very clear about what happens when
multiple <code>&lt;shadow&gt;</code> elements are in play:</p>
<p class="notice fact">If multiple <code>&lt;shadow&gt;</code> insertion points exist
in a shadow tree, only the first is recognized. The rest are ignored.</p>

<p>Looking back to our original example, the first shadow <code>root1</code> got left off the
invite list. Adding a <code>&lt;shadow&gt;</code> insertion point brings it back:</p>
<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"example2"</span><span class="tag">&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#example2'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root1 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root2 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root1</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div&gt;Root 1 FTW&lt;/div&gt;&lt;content&gt;&lt;/content&gt;'</span><span class="pun">;</span><span class="pln">
</span><b><span class="pln">root2</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div&gt;Root 2 FTW&lt;/div&gt;&lt;shadow&gt;&lt;/shadow&gt;'</span><span class="pun">;</span></b><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<div class="demodevtools"> 
<img src="http://rainer.qiniudn.com/shadow-insertion-point.png" title="Shadow insertion points" alt="Shadow insertion points" style="width:250px;">
</div>

<div class="demoarea">
  <div id="example2">Light DOM</div>
</div>

<script>
(function() {
var container = document.querySelector('#example2');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
root1.innerHTML = '<div>Root 1 FTW</div><content></content>';
root2.innerHTML = '<div>Root 2 FTW</div><shadow></shadow>';
})();
</script>

<p>There are a couple of interesting things about this example:</p>
<ol>
<li>"Root 2 FTW" still renders above "Root 1 FTW". This is because of where we've placed
the <code>&lt;shadow&gt;</code> insertion point. If you want the reverse, move the insertion point: <code>root2.innerHTML = '&lt;shadow&gt;&lt;/shadow&gt;&lt;div&gt;Root 2 FTW&lt;/div&gt;';</code>.</li>
<li>Notice there's now a <code>&lt;content&gt;</code> insertion point in root1. This makes
the text node "Light DOM" come along for the rendering ride.</li>
</ol>
<p><b id="toc-shadow-older">What's rendered at &lt;shadow&gt;?</b></p>
<p>Sometimes it's useful to know the older shadow tree being rendered at a <code>&lt;shadow&gt;</code>. You can get a reference to that tree through <code>.olderShadowRoot</code>:</p>
<pre class="prettyprint"><b><span class="pln">root2</span><span class="pun">.</span><span class="pln">olderShadowRoot</span></b><span class="pln"> </span><span class="pun">===</span><span class="pln"> root1 </span><span class="com">//true</span></pre>

<h2 id="toc-get-shadowroot">Obtaining a host's shadow root</h2>

<p>If an element is hosting Shadow DOM you can access its <a href="#youngest-tree">youngest shadow root</a>
using <code>.shadowRoot</code>:</p>
<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> host</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">host</span><span class="pun">.</span><span class="pln">shadowRoot </span><span class="pun">===</span><span class="pln"> root</span><span class="pun">);</span><span class="pln"> </span><span class="com">// true</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">shadowRoot</span><span class="pun">);</span><span class="pln"> </span><span class="com">// null</span></pre>

<p>If you're worried about people crossing into your shadows, redefine
 <code>.shadowRoot</code> to be null:</p>
<pre class="prettyprint"><span class="typ">Object</span><span class="pun">.</span><span class="pln">defineProperty</span><span class="pun">(</span><span class="pln">host</span><span class="pun">,</span><span class="pln"> </span><span class="str">'shadowRoot'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">get</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"> </span><span class="pun">},</span><span class="pln">
  </span><span class="kwd">set</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></pre>

<p>A bit of a hack, but it works. In the end, it's important to remember that while amazingly fantastic,
<strong>Shadow DOM has not been designed to be a security feature</strong>. Don't rely on it for
complete content isolation.</p>
<h2 id="toc-creating-js">Building Shadow DOM in JS</h2>

<p>If you prefer building DOM in JS, <code>HTMLContentElement</code> and <code>HTMLShadowElement</code>
have interfaces for that.</p>
<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"example3"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;span&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/span&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#example3'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root1 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root2 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> div </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">);</span><span class="pln">
div</span><span class="pun">.</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Root 1 FTW'</span><span class="pun">;</span><span class="pln">
root1</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">div</span><span class="pun">);</span><span class="pln">

 </span><span class="com">// HTMLContentElement</span><span class="pln">
</span><b><span class="kwd">var</span><span class="pln"> content </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'content'</span><span class="pun">);</span><span class="pln">
content</span><span class="pun">.</span><span class="pln">select </span><span class="pun">=</span><span class="pln"> </span><span class="str">'span'</span><span class="pun">;</span></b><span class="pln"> </span><span class="com">// selects any spans the host node contains</span><span class="pln">
root1</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">content</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> div </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">);</span><span class="pln">
div</span><span class="pun">.</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Root 2 FTW'</span><span class="pun">;</span><span class="pln">
root2</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">div</span><span class="pun">);</span><span class="pln">

</span><span class="com">// HTMLShadowElement</span><span class="pln">
</span><b><span class="kwd">var</span><span class="pln"> shadow </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'shadow'</span><span class="pun">);</span></b><span class="pln">
root2</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">shadow</span><span class="pun">);</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<p>This example is nearly identical to the one in the <a href="#toc-shadow-insertion">previous section</a>.
The only difference is that now I'm using <code>select</code> to pull out the newly added <code>&lt;span&gt;</code>.</p>
<h2 id="toc-distributed-nodes">Working with insertion points</h2>

<p>Nodes that are selected out of the host element and "distribute" into the shadow tree
are called...drumroll...distributed nodes! They're allowed to cross the shadow boundary
when insertion points invite them in.</p>
<p>What's conceptually bizarre about insertion points is that they don't physically
move DOM. The host's nodes stay intact. Insertion points merely re-project nodes
from the host into the shadow tree. It's a presentation/rendering thing: <s>"Move these nodes over here"</s> "Render these nodes at this location."</p>
<p class="notice fact">You cannot traverse the DOM into a <code>&lt;content&gt;</code>.</p>

<p>For example:</p>
<pre class="prettyprint"><span class="tag">&lt;div&gt;&lt;h2&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/h2&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;content select="h2"&gt;&lt;/content&gt;'</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> h2 </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'h2'</span><span class="pun">);</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'content[select="h2"] h2'</span><span class="pun">));</span><span class="pln"> </span><span class="com">// null;</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'content'</span><span class="pun">).</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">h2</span><span class="pun">));</span><span class="pln"> </span><span class="com">// false</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<p>Voil! The <code>h2</code> isn't a child of the shadow DOM. This leads to another tid bit:</p>
<blockquote class="commentary talkinghead">
Insertion points are incredibly powerful. Think of them as a way to create a
"declarative API" for your Shadow DOM. A host element can include all the markup in the world,
but unless I invite it into my Shadow DOM with an insertion point, it's meaningless.
</blockquote>

<h3 id="toc-getDistributedNodes">Element.getDistributedNodes()</h3>

<p>We can't traverse into a <code>&lt;content&gt;</code>, but the <code>.getDistributedNodes()</code> API
allows us to query the distributed nodes at an insertion point:</p>
<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"example4"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;h2&gt;</span><span class="pln">Eric</span><span class="tag">&lt;/h2&gt;</span><span class="pln">
  </span><span class="tag">&lt;h2&gt;</span><span class="pln">Bidelman</span><span class="tag">&lt;/h2&gt;</span><span class="pln">
  </span><span class="tag">&lt;div&gt;</span><span class="pln">Digital Jedi</span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;h4&gt;</span><span class="pln">footer text</span><span class="tag">&lt;/h4&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"sdom"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;header&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><span class="atn">select</span><span class="pun">=</span><span class="atv">"h2"</span><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/header&gt;</span><span class="pln">
  </span><span class="tag">&lt;section&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><span class="atn">select</span><span class="pun">=</span><span class="atv">"div"</span><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/section&gt;</span><span class="pln">
  </span><span class="tag">&lt;footer&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><span class="atn">select</span><span class="pun">=</span><span class="atv">"h4:first-of-type"</span><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/footer&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#example4'</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#sdom'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">importNode</span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="pln">content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">clone</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">
</span><span class="pun">[].</span><span class="pln">forEach</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="pln">querySelectorAll</span><span class="pun">(</span><span class="str">'content'</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">el</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  html</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">el</span><span class="pun">.</span><span class="pln">outerHTML </span><span class="pun">+</span><span class="pln"> </span><span class="str">': '</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> nodes </span><span class="pun">=</span><span class="pln"> el</span><span class="pun">.</span><span class="pln">getDistributedNodes</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">[].</span><span class="pln">forEach</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">nodes</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">node</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    html</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">node</span><span class="pun">.</span><span class="pln">outerHTML</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
  html</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">});</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<div id="example4" style="display:none">
  <h2>Eric</h2>
  <h2>Bidelman</h2>
  <div>Digital Jedi</div>
  <h4>footer text</h4>
</div>

<p><template id="sdom">
  <header>
    <content select="h2"></content>
  </header>
  <section>
    <content select="div"></content>
  </section>
  <footer>
    <content select="h4:first-of-type"></content>
  </footer>
</template></p>
<div id="example4-log" class="demoarea">
 <textarea readonly=""></textarea>
</div>

<script>
(function() {
if ('HTMLTemplateElement' in window) {
  var container = document.querySelector('#example4');

  var root1 = container.createShadowRoot();
  var t = document.querySelector('#sdom');
  var clone = document.importNode(t.content, true);
  root1.appendChild(clone);

  var html = [];
  [].forEach.call(root1.querySelectorAll('content'), function(el) {
    html.push(el.outerHTML + ': ');
    var nodes = el.getDistributedNodes();
    [].forEach.call(nodes, function(node) {
      html.push(node.outerHTML);
    });
    html.push('\n');
  });

  document.querySelector('#example4-log textarea').value = html.join('');
}
})();
</script>

<h3 id="toc-getDestinationInsertionPoints">Element.getDestinationInsertionPoints()</h3>

<p>Similar to <code>.getDistributedNodes()</code>, you can check what insertion points
a node is distributed into by calling its <code>.getDestinationInsertionPoints()</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"host"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;h2&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/h2&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> host </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">);</span><span class="pln">

  </span><span class="kwd">var</span><span class="pln"> root1 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> root2 </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
  root1</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;content select="h2"&gt;&lt;/content&gt;'</span><span class="pun">;</span><span class="pln">
  root2</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;shadow&gt;&lt;/shadow&gt;'</span><span class="pun">;</span><span class="pln">

  </span><span class="kwd">var</span><span class="pln"> h2 </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#host h2'</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> insertionPoints </span><span class="pun">=</span><span class="pln"> h2</span><span class="pun">.</span><span class="pln">getDestinationInsertionPoints</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">[].</span><span class="pln">forEach</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">insertionPoints</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">contentEl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">contentEl</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<div id="example5-gip" style="display:none">
  <h2>Light DOM</h2>
</div>

<div id="example5-getDestInsertinoPoints" class="demoarea">
 <textarea readonly=""></textarea>
</div>

<script>
(function() {
if (!!Element.prototype.getDestinationInsertionPoints) { 
  var container = document.querySelector('#example5-gip');
  var h2 = container.querySelector('h2');

  var root1 = container.createShadowRoot();
  var root2 = container.createShadowRoot();
  root1.innerHTML = '<content select="h2"></content>';
  root2.innerHTML = '<shadow></shadow>';

  var html = [];
  var insertionPoints = h2.getDestinationInsertionPoints();
  [].forEach.call(insertionPoints, function(contentEl) {
    html.push(contentEl.outerHTML);
    html.push('\n');
  });

  document.querySelector('#example5-getDestInsertinoPoints textarea').value = html.join('');
}
})();
</script>

<h2 id="toc-shadow-visualizder">Tool: Shadow DOM Visualizer</h2>

<p>Understanding the black magic that is Shadow DOM is difficult. I remember trying
to wrap my head around it for the first time.</p>
<p>To help visualize how Shadow DOM rendering works, I've built a tool
using <a href="http://d3js.org/">d3.js</a>. Both markup boxes on the left-hand side are
editable. Feel free to paste in your own markup and play around to see how things
work and insertion points swizzle host nodes into the shadow tree.</p>
<figure>
<a href="http://html5-demos.appspot.com/static/shadowdom-visualizer/index.html"><img src="http://rainer.qiniudn.com/visualizer.png" title="Shadow DOM Visualizer" alt="Shadow DOM Visualizer"></a>
<figcaption><a href="http://html5-demos.appspot.com/static/shadowdom-visualizer/index.html">Launch Shadow DOM Visualizer</a></figcaption>
</figure>

<p>
<iframe width="420" height="315" src="http://www.youtube.com/embed/qnJ_s58ubxg" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>Give it a try and let me know what you think!</p>
<h2 id="toc-events">Event Model</h2>

<p>Some events cross the shadow boundary and some do not. In the cases where events
cross the boundary, the event target is adjusted in order to maintain the
encapsulation that the shadow root's upper boundary provides. That is, <strong>events
are retargeted to look like they've come from the host element rather than internal
elements to the Shadow DOM</strong>.</p>
<p class="tip notice">Access <code>event.path</code> to see the adjusted event path.</p>

<p>If your browser supports Shadow DOM (it does<span class="featuresupported no">n't</span>),
you should see a play area below that helps visualize events. Elements in <span style="color:#ffcc00">yellow</span> are part of the Shadow DOM's markup. Elements in <span style="color:steelblue">blue</span> are
part of the host element. The <span style="color:#ffcc00">yellow</span> border
around "I'm a node in the host" signifies that it is a distributed node, passing
through the shadow's <code>&lt;content&gt;</code> insertion point.</p>
<p>The "Play Action" buttons show you different things to try. Give them a go to see
how the <code>mouseout</code> and <code>focusin</code> events bubble up to the main page.</p>
<div id="example5" class="demoarea">
  <div data-host="">
    <div class="blue">I'm a node in the host</div>
  </div>

  <template style="display:none;"> <!-- display:none used for older browsers -->
    <style>
    .scopestyleforolderbrowsers * {
      border: 4px solid #FC0;
    }
    .scopestyleforolderbrowsers input {
      padding: 5px;
    }
    .scopestyleforolderbrowsers div {
      background: #FC0;
      padding: 5px;
      border-radius: 3px;
      margin: 5px 0;
    }
    content::-webkit-distributed(*) {
      border: 4px solid #FC0;
    }
    ::content * {
      border: 4px solid #FC0;
    }
    </style>
    <section class="scopestyleforolderbrowsers">
      <div>I'm a node in Shadow DOM</div>
      <div>I'm a node in Shadow DOM</div>
      <content></content>
      <input type="text" placeholder="I'm in Shadow DOM">
      <div>I'm a node in Shadow DOM</div>
      <div>I'm a node in Shadow DOM</div>
    </section>
  </template>

  <aside class="cursor"></aside>

  <div class="buttons">
    <button data-action="playAnimation" data-action-idx="1">Play Action 1</button><br>
    <button data-action="playAnimation" data-action-idx="2">Play Action 2</button><br>
    <button data-action="playAnimation" data-action-idx="3">Play Action 3</button><br>
    <button data-action="clearLog">Clear log</button>
  </div>

  <output></output>
</div>

<script>
(function() {
function stringify(node) {
  return node.outerHTML.match(".*?>")[0].replace('<', '&lt;').replace('>', '&gt;');
}

var out = document.querySelector('#example5 output');
var host = document.querySelector('#example5 [data-host]');
var wrapper = document.querySelector('#example5');

var root = host.createShadowRoot();
root.innerHTML = document.querySelector('#example5 template').innerHTML;

host.addEventListener('mouseout', function(e) {

  out.innerHTML += [
    '<span>[' + e.type + ']</span>', 
    'on:', stringify(e.target) + ',', 
    'from', stringify(e.fromElement),
    '&rarr;', stringify(e.toElement), '<br>'].join(' ');
  out.scrollTop = out.scrollHeight;
});

document.addEventListener('focusin', function(e) {
  out.innerHTML += [
    '<span>[' + e.type + ']</span>',
    'on:', stringify(e.target), '<br>'].join(' ');
  out.scrollTop = out.scrollHeight;
});

function clearLog() {
  out.innerHTML = '';
}

function cleanUpAnimations(node) {
  [].forEach.call(node.classList, function(c) {
    if (c.indexOf('animation') == 0) {
      node.classList.remove(c);
    }
  });
}

function playAnimation(idx) {
  clearLog();
  wrapper.classList.add('playing');
  wrapper.classList.add('animation' + idx);
}

wrapper.addEventListener('webkitAnimationEnd', function(e) {
  this.classList.remove('playing');
  cleanUpAnimations(this);
});

wrapper.addEventListener('animationend', function(e) {
  this.classList.remove('playing');
  cleanUpAnimations(this);
});

document.querySelector('#example5 .buttons').addEventListener('click', function(e) {
  if (e.target.tagName == 'BUTTON') {
    switch(e.target.dataset.action) {
      case 'clearLog':
        clearLog();
        break;
      case 'playAnimation':
        cleanUpAnimations(wrapper);
        playAnimation(parseInt(e.target.dataset.actionIdx));
        break;
      default:
        break;
    }
  }
});

})();
</script>

<p><strong>Play Action 1</strong></p>
<ul>
<li>This one is interesting. You should see a <code>mouseout</code> from the host element (<code>&lt;div data-host&gt;</code>)
to the <span style="color:steelblue">blue</span> node. Even though it's a distributed
node, it's still in the host, not the ShadowDOM. Mousing further down into 
<span style="color:#ffcc00">yellow</span> again causes a <code>mouseout</code> on the <span style="color:steelblue">blue</span> node.</li>
</ul>
<p><strong>Play Action 2</strong></p>
<ul>
<li>There is one <code>mouseout</code> that appears on host (at the very end). Normally you'd
see <code>mouseout</code> events trigger for all of the <span style="color:#ffcc00">yellow</span> blocks.
However, in this case these elements are internal to the Shadow DOM and the event
doesn't bubble through its upper boundary.</li>
</ul>
<p><strong>Play Action 3</strong></p>
<ul>
<li>Notice that when you click the input, the <code>focusin</code> doesn't appear on the
input but on the host node itself. It's been retargeted!</li>
</ul>
<h3 id="toc-events-stopped">Events that are always stopped</h3>

<p>The following events never cross the shadow boundary:</p>
<ul>
<li>abort</li>
<li>error</li>
<li>select</li>
<li>change</li>
<li>load</li>
<li>reset</li>
<li>resize</li>
<li>scroll</li>
<li>selectstart</li>
</ul>
<h2 id="toc-conclusion">Conclusion</h2>

<p>I hope you'll agree that <strong>Shadow DOM is incredibly powerful</strong>. For the first time ever, we have proper encapsulation without the extra baggage of <code>&lt;iframe&gt;</code>s or other older techniques. </p>
<p>Shadow DOM is certainly complex beast, but it's a beast worth adding to the web platform.
Spend some time with it. Learn it. Ask questions.</p>
<p>If you want to learn more, see Dominic's intro article <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom/">Shadow DOM 101</a>
and my <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-201/">Shadow DOM 201: CSS &amp; Styling</a> article.</p>
<p class="small-notice">
Thanks to <a href="http://Robing.github.io/profiles/#dominiccooney">Dominic Cooney</a> and 
<a href="https://plus.google.com/111648463906387632236/posts">Dimitri Glazkov</a> for reviewing
the content of this tutorial.
</p><script>
document.addEventListener('DOMContentLoaded', function(e) {
  if (!isCompatible()) {
    document.body.classList.add('disabledemos');
    $('.featuresupported').removeClass('no');
  }
});
</script>

      </div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shadow DOM 201]]></title>
    <link href="http://Robing.github.io/blog/2014/05/16/shadow-dom-201/"/>
    <updated>2014-05-16T12:16:18+08:00</updated>
    <id>http://Robing.github.io/blog/2014/05/16/shadow-dom-201</id>
    <content type="html"><![CDATA[<div class="content" id="article-content">

    <p>This article discusses more of the amazing things you can do with Shadow DOM. It builds on the concepts discussed in <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom/">Shadow DOM 101</a>. If you're looking for an introduction, see that article.</p>
    <h2 id="toc-intro">Introduction</h2>

    <p>Let's face it. There's nothing sexy about unstyled markup. Lucky for us, <a href="http://w3c.github.io/webcomponents/explainer/#acknowledgements">the brilliant folks behind Web Components</a>
        foresaw this and didn't leave us hanging. The <a href="http://dev.w3.org/csswg/css-scoping/">CSS Scoping Module</a> defines many options for styling content in a shadow tree.</p>
    <p class="tip notice">In Chrome, turn on the "Enable experimental Web Platform features" in about:flags to experiment with everything covered in this article.</p>

    <h2 id="toc-style-scoped">Style encapsulation</h2>

    <p>One of the core features of Shadow DOM is the <a href="http://w3c.github.io/webcomponents/spec/shadow/#shadow-trees">shadow boundary</a>. It has a lot of nice properties, but one of the best is that it provides style encapsulation for free. Stated another way:</p>
    <p class="notice fact">CSS styles defined inside Shadow DOM are scoped to the ShadowRoot. This means styles are encapsulated by default.</p>

    <p>Below is an example. If all goes well and your browser supports Shadow DOM (it does
        <span class="featuresupported no">n't</span>!), you'll see "
        <span style="color:red">Shadow DOM</span>".</p>
    <pre class="prettyprint"><code><span class="tag">&lt;div&gt;&lt;h3&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/h3&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;style&gt;h3{ color: red; }&lt;/style&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
                 </span><span class="str">'&lt;h3&gt;Shadow DOM&lt;/h3&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
    <div class="demoarea">
        <div id="style-ex-scoped">
            <h3>Light DOM</h3>
        </div>
    </div>

    <script>
    (function() {
        var container = document.querySelector('#style-ex-scoped');
        var root = container.createShadowRoot();
        root.innerHTML = '<style>h3{color: red;}</style><h3>Shadow DOM</h3>';
    })();
    </script>

    <p>There are two interesting observations about this demo:</p>
    <ul>
        <li>There are
            <a onclick=alertMsg() href="#">other h3s on this page</a>, but the only one that matches the h3 selector, and therefore styled red, is the one in the ShadowRoot. Again, scoped styles by default.</li>
        <li>Other styles rules defined on this page that target h3s don't bleed into my content. That's because
            <strong>selectors don't cross the shadow boundary</strong>.</li>
    </ul>
    <script type="text/javascript">
    var alertMsg = function(msg){
        if(msg){
            alert(msg)
        }else{
            len = document.querySelectorAll('h3').length;
            msg = 'There are ' + len + ' <h3> on this page.';
            alert(msg);
        }
        return false;
    }
    </script>
    <p>Moral of the story? We have style encapsulation from the outside world. Thanks Shadow DOM!</p>
    <!-- more -->
    <h2 id="toc-style-host">Styling the host element</h2>

    <p>The
        <code>:host</code>allows you to select and style the element hosting a shadow tree:</p>
    <pre class="prettyprint"><code><span class="tag">&lt;button</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"red"</span><span class="tag">&gt;</span><span class="pln">My Button</span><span class="tag">&lt;/button&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> button </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'button'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> button</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;style&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
    </span><span class="str">':host { text-transform: uppercase; }'</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">'&lt;/style&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
    </span><span class="str">'&lt;content&gt;&lt;/content&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
    <div class="demoarea">
        <button id="style-athost" class="red">My Button</button>
    </div>

    <script>
    (function() {
        var container = document.querySelector('#style-athost');
        var root = container.createShadowRoot();
        root.innerHTML = '<style>' +
            ':host { text-transform: uppercase; }' +
            '</style>' +
            '<content></content>';
    })();
    </script>

    <p>One gotcha is that rules in the parent page have higher specificity than
        <code>:host</code>
        rules defined in the element, but lower specificity than a
        <code>style</code>attribute defined on the host element. This allows users to override your styling from the outside.
        <code>:host</code>also only works in the context of a ShadowRoot so you can't use it outside of Shadow DOM.</p>
    <p>The functional form of
        <code>:host(&lt;selector&gt;)</code>allows you to target the host element if it matches a
        <code>&lt;selector&gt;</code>.</p>
    <p>
        <strong>Example</strong>- match only if the element itself has the class
        <code>.different</code>(e.g..
        <code>&lt;x-foo class="different"&gt;&lt;/x-foo&gt;</code>):</p>
    <pre class="prettyprint"><code><span class="pun">:</span><span class="pln">host</span><span class="pun">(.</span><span class="pln">different</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">  
</span><span class="pun">}</span></code></pre>
    <h3 id="toc-style-states">Reacting to user states</h3>

    <p>A common use case for
        <code>:host</code>is when you're creating a <a href="http://Robing.github.io/tutorials/webcomponents/customelements/">Custom Element</a> and want to react to different user states (:hover, :focus, :active, etc.).</p>
    <pre class="prettyprint"><code><span class="tag">&lt;style&gt;</span><span class="pln">
</span><span class="pun">:</span><span class="pln">host </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">opacity</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.4</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">transition</span><span class="pun">:</span><span class="pln"> opacity </span><span class="lit">420ms</span><span class="pln"> ease-in-out</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">:</span><span class="pln">host</span><span class="pun">(:</span><span class="pln">hover</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">opacity</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">:</span><span class="pln">host</span><span class="pun">(:</span><span class="pln">active</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">position</span><span class="pun">:</span><span class="pln"> relative</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3px</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">left</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3px</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span></code></pre>
    <div class="demoarea">
        <button id="style-athost-ex2">My Button</button>
    </div>

    <script>
    (function() {
        var container = document.querySelector('#style-athost-ex2');
        var root = container.createShadowRoot();
        root.innerHTML = '<style>\
      :host {\
        opacity: 0.4;\
        transition: opacity 200ms ease-in-out;\
      }\
      :host(:active) { position:relative;top:3px;left:3px; }\
      :host(:hover) {\
        opacity: 1;\
      }\
    }</style><content></content>';
    })();
    </script>

    <h3 id="toc-style-themeing">Theming an element</h3>

    <p>The
        <code>:host-context(&lt;selector&gt;)</code>pseudo class matches the host element if it or any of its ancestors matches
        <code>&lt;selector&gt;</code>.</p>
    <p>A common use of
        <code>:host-context()</code>is for theming an element based on its surrounds. For example, many people do theming by applying a class to
        <code>&lt;html&gt;</code>or
        <code>&lt;body&gt;</code>:</p>
    <pre class="prettyprint"><code><span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"different"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;x-foo&gt;&lt;/x-foo&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
    <p>You can
        <code>:host-context(.different)</code>to style
        <code>&lt;x-foo&gt;</code>when it's a descendant of an element with the class
        <code>.different</code>:</p>
    <pre class="prettyprint"><code><span class="pun">:</span><span class="pln">host</span><span class="pun">-</span><span class="pln">context</span><span class="pun">(.</span><span class="pln">different</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <p>This gives you the ability encapsulate style rules in an element's Shadow DOM that uniquely style it, based on its context.</p>
    <h3 id="toc-style-multi">Support multiple host types from within one shadow root</h3>

    <p>Another use for
        <code>:host</code>is if you're creating a theming library and want to support styling many types of host elements from within the same Shadow DOM.</p>
    <pre class="prettyprint"><code><span class="pun">:</span><span class="pln">host</span><span class="pun">(</span><span class="pln">x</span><span class="pun">-</span><span class="pln">foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
  </span><span class="com">/* Applies if the host is a &lt;x-foo&gt; element.*/</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="pun">:</span><span class="pln">host</span><span class="pun">(</span><span class="pln">x</span><span class="pun">-</span><span class="pln">foo</span><span class="pun">:</span><span class="pln">host</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
  </span><span class="com">/* Same as above. Applies if the host is a &lt;x-foo&gt; element. */</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="pun">:</span><span class="pln">host</span><span class="pun">(</span><span class="pln">div</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="pun">{</span><span class="pln">
  </span><span class="com">/* Applies if the host element is a &lt;div&gt;. */</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <h2 id="toc-style-cat-hat">Styling Shadow DOM internals from the outside</h2>

    <p>The
        <code>::shadow</code>pseudo-element and
        <code>/deep/</code>combinator are like having a Vorpal sword of CSS authority. They allow piercing through Shadow DOM's boundary to style elements within shadow trees.</p>
    <h3 id="toc-style-hat">The ::shadow pseudo-element</h3>

    <p>If an element has at least one shadow tree, the
        <code>::shadow</code>pseudo-element matches the shadow root itself. It allows you to write selectors that style nodes internal to an element's shadow dom.</p>
    <p>For example, if an element is hosting a shadow root, you can write
        <code>#host::shadow span {}</code>to style all of the spans within its shadow tree.</p>
    <pre class="prettyprint"><code><span class="tag">&lt;style&gt;</span><span class="pln">
  </span><span class="pun">#</span><span class="kwd">host</span><span class="pun">::</span><span class="pln">shadow span </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">

</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"host"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;span&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/span&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> host </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> host</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
  root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">"&lt;span&gt;Shadow DOM&lt;/span&gt;"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
                   </span><span class="str">"&lt;content&gt;&lt;/content&gt;"</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
    <div class="demoarea">
        <div id="style-hat-ex">
            <span>Light DOM</span>
        </div>
    </div>

    <script>
    (function() {
        var host = document.querySelector('#style-hat-ex');
        var root = host.createShadowRoot();
        root.innerHTML = '<span>Shadow DOM</span>' +
            '<content></content>';
    })();
    </script>

    <p>
        <strong>Example</strong>(custom elements) -
        <code>&lt;x-tabs&gt;</code>has
        <code>&lt;x-panel&gt;</code>children in its Shadow DOM. Each panel hosts its own shadow tree containing
        <code>h2</code>headings. To style those headings from the main page, one could write:</p>
    <pre class="prettyprint"><code><span class="pln">x</span><span class="pun">-</span><span class="pln">tabs</span><span class="pun">::</span><span class="pln">shadow x</span><span class="pun">-</span><span class="pln">panel</span><span class="pun">::</span><span class="pln">shadow h2 </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <h3 id="toc-style-cat">The /deep/ combinator</h3>

    <p>The
        <code>/deep/</code>combinator is similar to
        <code>::shadow</code>, but more powerful. It completely ignores all shadow boundaries and crosses into any number of shadow trees. Put simply,
        <code>/deep/</code>allows you to drill into an element's guts and target any node.</p>
    <p>The
        <code>/deep/</code>combinator is particularly useful in the world of Custom Elements where it's common to have multiple levels of Shadow DOM. Prime examples are nesting a bunch of custom elements (each hosting their own shadow tree) or creating an element that inherits from another using
        <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-301/#toc-shadow-insertion">
            <code>&lt;shadow&gt;</code>
        </a>.</p>
    <p>
        <strong>Example</strong>(custom elements) - select all
        <code>&lt;x-panel&gt;</code>elements that are descendants of
        <code>&lt;x-tabs&gt;</code>, anywhere in the tree:</p>
    <pre class="prettyprint"><code><span class="pln">x</span><span class="pun">-</span><span class="pln">tabs </span><span class="pun">/</span><span class="pln">deep</span><span class="pun">/</span><span class="pln"> x</span><span class="pun">-</span><span class="pln">panel </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <p>
        <strong>Example</strong>- style all elements with the class
        <code>.library-theme</code>, anywhere in a shadow tree:</p>
    <pre class="prettyprint"><code><span class="pln">body </span><span class="pun">/</span><span class="pln">deep</span><span class="pun">/</span><span class="pln"> </span><span class="pun">.</span><span class="pln">library</span><span class="pun">-</span><span class="pln">theme </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <h3 id="toc-css-traverasl">Working with querySelector()</h3>

    <p>Just like
        <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-301/#toc-get-shadowroot">
            <code>.shadowRoot</code>
        </a>opens shadow trees up for DOM traversal, the combinators open shadow trees for selector traversal. Instead of writing a nested chain of madness, you can write a single statement:</p>
    <pre class="prettyprint"><code><span class="com">// No fun.</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'x-tabs'</span><span class="pun">).</span><span class="pln">shadowRoot
        </span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'x-panel'</span><span class="pun">).</span><span class="pln">shadowRoot
        </span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#foo'</span><span class="pun">);</span><span class="pln">

</span><span class="com">// Fun.</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'x-tabs::shadow x-panel::shadow #foo'</span><span class="pun">);</span></code></pre>
    <h3 id="toc-style-native">Styling native elements</h3>

    <p>Native HTML controls are a challenge to style. Many people simply give up and roll their own. However, with
        <code>::shadow</code>and
        <code>/deep/</code>, any element in the web platform that uses Shadow DOM can be styled. Great examples are the
        <code>&lt;input&gt;</code>types and
        <code>&lt;video&gt;</code>:</p>
    <pre class="prettyprint"><code><span class="pln">video </span><span class="pun">/</span><span class="pln">deep</span><span class="pun">/</span><span class="pln"> input</span><span class="pun">[</span><span class="pln">type</span><span class="pun">=</span><span class="str">"range"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  background</span><span class="pun">:</span><span class="pln"> hotpink</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <div class="demoarea">
        <video id="ex-style-video" controls=""></video>
    </div>

    <blockquote class="commentary talkinghead">
        Do the
        <code>::shadow</code>pseudo-element and
        <code>/deep/</code>combinator defeat the purpose of style encapsulation? Out of the box, Shadow DOM prevents
        <em>accidental</em>styling from outsiders but it never promises to be a bullet proof vest. Developers should be allowed to
        <em>intentionally</em>style inner parts of your Shadow tree...if they know what they're doing. Having more control is also good for flexibility, theming, and the re-usability of your elements.
    </blockquote>

    <h2 id="toc-style-hooks">Creating style hooks</h2>

    <p>Customization is good. In certain cases, you may want to poke holes in your Shadow's styling shield and create hooks for others to style.</p>
    <h3 id="toc-custom-pseduo">Using ::shadow and /deep/</h3>

    <p>There's a lot of power behind
        <code>/deep/</code>. It gives component authors a way to designate individual elements as styleable or a slew of elements as themeable.</p>
    <p>
        <strong>Example</strong>- style all elements that have the class
        <code>.library-theme</code>, ignoring all shadow trees:</p>
    <pre class="prettyprint"><code><span class="pln">body </span><span class="pun">/</span><span class="pln">deep</span><span class="pun">/</span><span class="pln"> </span><span class="pun">.</span><span class="pln">library</span><span class="pun">-</span><span class="pln">theme </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
    <p></p>
    <h3 id="toc-vars">Using CSS Variables</h3>

    <p>A powerful way to create theming hooks will be through <a href="http://dev.w3.org/csswg/css-variables/">CSS Variables</a>. Essentially, creating "style placeholders" for other users to fill in.</p>
    <p>Imagine a custom element author who marks out variable placeholders in their Shadow DOM. One for styling an internal button's font and another for its color:</p>
    <pre class="prettyprint"><code><span class="pln">button </span><span class="pun">{</span><span class="pln">
  color</span><span class="pun">:</span><span class="pln"> </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var ...
   -moz-var ...
    -ms-var ...
     -o-var ...
        var ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">button</span><span class="pun">-</span><span class="pln">text</span><span class="pun">-</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> pink</span><span class="pun">);</span></a><span class="pln"> </span><span class="com">/* default color will be pink */</span><span class="pln">
  font</span><span class="pun">:</span><span class="pln"> </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var ...
   -moz-var ...
    -ms-var ...
     -o-var ...
        var ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">button</span><span class="pun">-</span><span class="pln">font</span><span class="pun">)</span><span class="pln"> </span><span class="pun">;</span></a><span class="pln">
</span><span class="pun">}</span></code></pre>
    <p>Then, the embedder of the element defines those values to their liking. Perhaps to match the super cool Comic Sans theme of their own page:</p>
    <pre class="prettyprint"><code><span class="com">#host {</span><span class="pln">
  </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var-button-text-color: ...
   -moz-var-button-text-color: ...
    -ms-var-button-text-color: ...
     -o-var-button-text-color: ...
        var-button-text-color: ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var</span><span class="pun">-</span><span class="pln">button</span><span class="pun">-</span><span class="pln">text</span><span class="pun">-</span><span class="pln">color</span><span class="pun">:</span></span><span class="pln"> green</span><span class="pun">;</span></a><span class="pln">
  </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var-button-font: ...
   -moz-var-button-font: ...
    -ms-var-button-font: ...
     -o-var-button-font: ...
        var-button-font: ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var</span><span class="pun">-</span><span class="pln">button</span><span class="pun">-</span><span class="pln">font</span><span class="pun">:</span></span><span class="pln"> </span><span class="str">"Comic Sans MS"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Comic Sans"</span><span class="pun">,</span><span class="pln"> cursive</span><span class="pun">;</span></a><span class="pln">
</span><span class="pun">}</span></code></pre>
    <p>Due to the way CSS Variables inherit, everything is peachy and this works beautifully! The whole picture looks like this:</p>
    <pre class="prettyprint"><code><span class="tag">&lt;style&gt;</span><span class="pln">
  </span><span class="pun">#</span><span class="pln">host </span><span class="pun">{</span><span class="pln">
    </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var-button-text-color: ...
   -moz-var-button-text-color: ...
    -ms-var-button-text-color: ...
     -o-var-button-text-color: ...
        var-button-text-color: ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var-button-text-color</span><span class="pun">:</span></span><span class="pln"> green</span><span class="pun">;</span></a><span class="pln">
    </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var-button-font: ...
   -moz-var-button-font: ...
    -ms-var-button-font: ...
     -o-var-button-font: ...
        var-button-font: ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="pun">+</span><span class="property"><span class="kwd">var-button-font</span><span class="pun">:</span></span><span class="pln"> </span><span class="str">"Comic Sans MS"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Comic Sans"</span><span class="pun">,</span><span class="pln"> cursive</span><span class="pun">;</span></a><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"host"</span><span class="tag">&gt;</span><span class="pln">Host node</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#host'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;style&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
    </span><span class="str">'button {'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
      </span><span class="str">'color: </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var ...
   -moz-var ...
    -ms-var ...
     -o-var ...
        var ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="str">+</span><span class="property"><span class="str">var</span></span><span class="str"> (button-text-color, pink);</span></a><span class="str">'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
      </span><span class="str">'font: </span><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#including_a_mixin" id="tooltip673.63" target="_blank" data-tooltip="/*Vendor prefixes required. Try Compass/SASS.*/
-webkit-var ...
   -moz-var ...
    -ms-var ...
     -o-var ...
        var ..." role="tooltip" aria-describedby="tooltip673.63" class="noexternal tooltip"><span class="str">+</span><span class="property"><span class="str">var</span></span><span class="str"> (button-font) ;</span></a><span class="str">'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
    </span><span class="str">'}'</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">'&lt;/style&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">'&lt;content&gt;&lt;/content&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
    <blockquote class="commentary talkinghead">
        I've already mentioned <a href="http://Robing.github.io/tutorials/webcomponents/customelements/">Custom Elements</a> a few times in this article. For now, just know that Shadow DOM forms their structural foundation by providing styling and DOM encapsulation. The concepts here pertain to styling Custom Elements.
    </blockquote>

    <p></p>
    <h2 id="toc-style-disbtributed-nodes">Styling distributed nodes</h2>

    <p>Distributed nodes are elements that render at an <a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-301/#toc-distributed-nodes">insertion point</a> (a
        <code>&lt;content&gt;</code>element). The
        <code>&lt;content&gt;</code>element allows you to select nodes from the Light DOM and render them at predefined locations in your Shadow DOM. They're not logically in the Shadow DOM; they're still children of the host element. Insertion points are just a rendering thing.</p>
    <p>Distributed nodes retain styles from the main document. That is, style rules from the main page continue to apply to the elements, even when they render at an insertion point. Again, distributed nodes are still logically in the light dom and don't move. They just render elsewhere. However, when the nodes get distributed into the Shadow DOM, they can take on additional styles defined inside the shadow tree.</p>
    <h3 id="toc-distributed">::content pseudo element</h3>

    <p>Distributed nodes are children of the host element, so how can we target them from
        <em>within</em>the Shadow DOM? The answer is the CSS
        <code>::content</code>pseudo element. It's a way to target Light DOM nodes that pass through an insertion point. For example:</p>
    <p>
        <code>::content &gt; h3</code>styles any
        <code>h3</code>tags that pass through an insertion point.</p>
    <p>Let's see an example:</p>
    <pre class="prettyprint"><code><span class="tag">&lt;div&gt;</span><span class="pln">
  </span><span class="tag">&lt;h3&gt;</span><span class="pln">Light DOM</span><span class="tag">&lt;/h3&gt;</span><span class="pln">
  </span><span class="tag">&lt;section&gt;</span><span class="pln">
    </span><span class="tag">&lt;div&gt;</span><span class="pln">I'm not underlined</span><span class="tag">&lt;/div&gt;</span><span class="pln">
    </span><span class="tag">&lt;p&gt;</span><span class="pln">I'm underlined in Shadow DOM!</span><span class="tag">&lt;/p&gt;</span><span class="pln">
  </span><span class="tag">&lt;/section&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> div </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'div'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> div</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'</span><span class="pln">\
    </span><span class="pun">&lt;</span><span class="pln">style</span><span class="pun">&gt;</span><span class="pln">\
      h3 </span><span class="pun">{</span><span class="pln"> color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">\
      content</span><span class="pun">[</span><span class="pln">select</span><span class="pun">=</span><span class="str">"h3"</span><span class="pun">]::</span><span class="pln">content </span><span class="pun">&gt;</span><span class="pln"> h3 </span><span class="pun">{</span><span class="pln">\
        color</span><span class="pun">:</span><span class="pln"> green</span><span class="pun">;</span><span class="pln">\
      </span><span class="pun">}</span><span class="pln">\
      </span><span class="pun">::</span><span class="pln">content section p </span><span class="pun">{</span><span class="pln">\
        text</span><span class="pun">-</span><span class="pln">decoration</span><span class="pun">:</span><span class="pln"> underline</span><span class="pun">;</span><span class="pln">\
      </span><span class="pun">}</span><span class="pln">\
    </span><span class="pun">&lt;</span><span class="str">/style&gt;\
    &lt;h3&gt;Shadow DOM&lt;/</span><span class="pln">h3</span><span class="pun">&gt;</span><span class="pln">\
    </span><span class="pun">&lt;</span><span class="pln">content select</span><span class="pun">=</span><span class="str">"h3"</span><span class="pun">&gt;&lt;/</span><span class="pln">content</span><span class="pun">&gt;</span><span class="pln">\
    </span><span class="pun">&lt;</span><span class="pln">content select</span><span class="pun">=</span><span class="str">"section"</span><span class="pun">&gt;&lt;/</span><span class="pln">content</span><span class="pun">&gt;</span><span class="str">';</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
    <div class="demoarea">
        <div id="style-ex-distributed">
            <h3>Light DOM</h3>
            <section>
                <div>I'm not underlined</div>
                <p>I'm underlined in Shadow DOM!</p>
            </section>
        </div>
    </div>

    <script>
    (function() {
        var container = document.querySelector('#style-ex-distributed');
        var root = container.createShadowRoot();
        root.innerHTML = '\
  <style>\
    h3 { color: red; }\
    content[select="h3"]::content > h3 {\
      color: green;\
    }\
    ::content section p {\
      text-decoration: underline;\
    }\
  </style>\
  <h3>Shadow DOM</h3>\
  <content select="h3"></content>\
  <content select="section"></content>';
    })();
    </script>

    <p>You should see "
        <span style="color:red">Shadow DOM</span>" and "
        <span style="color:green">Light DOM</span>" below it. Also note that "Light DOM" is still retaining the styles (margins etc.) defined on this page. That's because the page's styles still match!</p>
    <p></p>


    <blockquote class="commentary talkinghead">
        Remember: styles defined in the host document continue to apply to nodes they target, even when those nodes get distributed "inside" the Shadow DOM. Going into an insertion point doesn't change what's applied.
    </blockquote>

    <h2 id="toc-conclusion">Conclusion</h2>

    <p>As authors of custom elements, we have a ton of options for controlling the look and feel of our content. Shadow DOM forms the basis for this brave new world.</p>
    <p>Shadow DOM gives us scoped style encapsulation and a means to let in as much (or as little) of the outside world as we choose. By defining custom pseudo elements or including CSS Variable placeholders, authors can provide third-parties convenient styling hooks to further customize their content. All in all, web authors are in full control of how their content is represented.</p>
    <p class="small-notice">
        Thanks to <a href="http://Robing.github.io/profiles/#dominiccooney">Dominic Cooney</a> and
        <a href="https://plus.google.com/111648463906387632236/posts">Dimitri Glazkov</a> for reviewing the content of this tutorial.
    </p>

    <p>
    </p>
    <aside class="panel">
        <h2>Related reading</h2>
        <ul>
            <li><a href="http://Robing.github.io/tutorials/webcomponents/shadowdom/">Shadow DOM 101</a>
            </li>
            <li><a href="http://Robing.github.io/tutorials/webcomponents/shadowdom-301/">Shadow DOM 301 - Advanced Concepts &amp; DOM APIs</a>
            </li>
            <li><a href="http://Robing.github.io/tutorials/webcomponents/customelements/">Custom Elements - defining new elements in HTML</a>
            </li>
        </ul>
    </aside>
    <p></p>
    <script>
    document.addEventListener('DOMContentLoaded', function(e) {
        if (!isCompatible()) {
            document.body.classList.add('disabledemos');
            $('.featuresupported').removeClass('no');
        }
    });
    </script>

</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shadow DOM 101]]></title>
    <link href="http://Robing.github.io/blog/2014/05/16/shadow-dom-101/"/>
    <updated>2014-05-16T10:09:17+08:00</updated>
    <id>http://Robing.github.io/blog/2014/05/16/shadow-dom-101</id>
    <content type="html"><![CDATA[<div class="content" id="article-content">        
<p></p>

<h2 id="toc-introduction"></h2>

<p>
Web 
</p>

<ol>
<li>(widget)</li>
<li></li>
<li>

</li>
</ol>

<p>
 HTML/JavaScript Web HTML  JavaScript 
 HTML  JavaScript Web 
</p>

<blockquote class="commentary talkinghead">
 <code>&lt;canvas&gt;</code> (accessibility)(indexing)(composition)(resolution independence)
</blockquote>

<p>
 HTML  JavaScript  DOM 

JavaScript  ID  ID 
</p>

<blockquote class="commentary">
 DOM 
</blockquote>

<p>
Web 
</p>

<ol>
<li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html">Templates</a></li>
<li><a href="http://www.w3.org/TR/shadow-dom/">Shadow
DOM</a></li>
<li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">Custom
Elements</a></li>
<li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/explainer/index.html#external-custom-elements-and-decorators">Packaging</a></li>
</ol>

<p>
<b>Shadow DOM</b>  DOM Web  Web  Shadow DOM
</p>

<p class="notice">
<b></b> Chrome 25+  Shadow DOM API  <code>webkit</code>   Chrome  API <code>about:flags</code>  ""
</p>

<h2 id="toc-hello-world">Hello, Shadow World</h2>

<p>
 Shadow DOM <b>shadow root</b> shadow root  <b>shadow host</b>shadow host shadow root 
</p>
<!-- more -->
<p>

</p>

<span class="tag">&lt;button&gt;</span><span class="pln">Hello, world!</span><span class="tag">&lt;/button&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> host </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'button'</span><span class="pun">);</span><span class="pln">
</span><b><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> host</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span></b><span class="pln">
root</span><span class="pun">.</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'!'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span>


<p></p>

<button id="ex1a">Hello, world!</button>
<script>
function remove(selector) {
  Array.prototype.forEach.call(
      document.querySelectorAll(selector),
      function (node) { node.parentNode.removeChild(node); });
}

if (!HTMLElement.prototype.webkitCreateShadowRoot) {
  remove('#ex1a');
  document.write('<img src="SS1.png" alt="Screenshot of a button with \'Hello, world!\' on it.">');
}
</script>

<p></p>

<button id="ex1b">Hello, world!</button>
<script>
(function () {
  if (!HTMLElement.prototype.webkitCreateShadowRoot) {
    remove('#ex1b');
    document.write('<img src="SS2.png" alt="Screenshot of a button with \'Hello, shadow world!\' in Japanese on it.">');
    return;
  }
  var host = document.querySelector('#ex1b');
  var root = host.webkitCreateShadowRoot();
  root.textContent = '!';
})();
</script>

<p>
 JavaScript  <span class="property">textContent</span>  ! Hello, world! shadow root  DOM 
</p>

<p>
()
<em></em> Shadow DOM 
 Shadow DOM 
</p>

<blockquote class="commentary talkinghead">
 web 
</blockquote>

<h2 id="toc-separation"></h2>

<p>
 Shadow DOM 
</p>

<style>
.ex2a.outer {
  border: 2px solid brown;
  border-radius: 1em;
  background: red;
  font-size: 20pt;
  width: 12em;
  height: 7em;
  text-align: center;
}
.ex2a .boilerplate {
  color: white;
  font-family: sans-serif;
  padding: 0.5em;
}
.ex2a .name {
  color: black;
  background: white;
  font-family: "Marker Felt", cursive;
  font-size: 45pt;
  padding-top: 0.2em;
}
</style>
<div class="ex2a outer">
  <div class="boilerplate">
    Hi! My name is
  </div>
  <div class="name">
    Bob
  </div>
</div>

<p>
 Shadow DOM
</p>

<pre class="prettyprint"><span class="tag">&lt;style&gt;</span><span class="pln">
</span><span class="pun">.</span><span class="pln">outer </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2px</span><span class="pln"> solid brown</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">border-radius</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20pt</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">text-align</span><span class="pun">:</span><span class="pln"> center</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">.</span><span class="pln">boilerplate </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> white</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-family</span><span class="pun">:</span><span class="pln"> sans-serif</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.5em</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">.</span><span class="pln">name </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> black</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> white</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-family</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Marker Felt"</span><span class="pun">,</span><span class="pln"> cursive</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">45pt</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">padding-top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.2em</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"outer"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"boilerplate"</span><span class="tag">&gt;</span><span class="pln">
    Hi! My name is
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;</span><span class="pln">
    Bob
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
 DOM 
</p>

<p></p>

<h3 id="toc-separation-hide"></h3>

<p>

</p>

<ul>
<li></li>
<li> Bob</li>
</ul>

<p>

</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTag"</span><span class="tag">&gt;</span><span class="pln">Bob</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
 div  <code>&lt;template&gt;</code> 
</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTag"</span><span class="tag">&gt;</span><span class="pln">Bob</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><b><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTagTemplate"</span><span class="tag">&gt;</span></b><span class="pln">
</span><span class="unchanged"><span class="tag">&lt;style&gt;</span><span class="pln">
</span><span class="pun">.</span><span class="pln">outer </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2px</span><span class="pln"> solid brown</span><span class="pun">;</span><span class="pln">

  </span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="pln"> </span><span class="pun"></span><span class="pln">

</span><span class="tag">&lt;/style&gt;</span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"outer"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"boilerplate"</span><span class="tag">&gt;</span><span class="pln">
    Hi! My name is
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;</span><span class="pln">
    Bob
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></span><span class="pln">
</span><b><span class="tag">&lt;/template&gt;</span></b>
</pre>

<p>
Bob  DOM  <code>&lt;template&gt;</code> <em></em> JavaScript  shadow root
</p>

<pre class="prettyprint"><span class="tag">&lt;script&gt;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> shadow </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#nameTag'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> template </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#nameTagTemplate'</span><span class="pun">);</span><span class="pln">
shadow</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">template</span><span class="pun">.</span><span class="pln">content</span><span class="pun">);</span><span class="pln">
template</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">();</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></pre>

<blockquote class="commentary talkinghead">
Templates Shadow DOM Chrome Canary  <code>&lt;template&gt;</code>  <span class="property">innerHTML</span><span class="method">appendChild</span><span class="method">getElementById</span>  shadow root Shadow DOM template  <code>&lt;template&gt;</code>  <a href="http://Robing.github.io/tutorials/webcomponents/template/">HTML  Template </a>.
</blockquote>

<p>
 shadow root
</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTag"</span><span class="tag">&gt;</span><span class="pln">Bob</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
 Shadow DOM Shadow DOM 
</p>

<h3 id="toc-separation-separate">

</h3>

<p>

(Bob) shadow root 

</p>

<p>
HTML   
Hi!
</p>

<p>
 <code>&lt;content&gt;</code> 
(insertion point) shadow host 
</p>

<p>
 Shadow DOM 
</p>

<pre class="prettyprint"><span class="unchanged"><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTagTemplate"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;style&gt;</span><span class="pln">
  </span><span class="pun"></span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span></span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"outer"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"boilerplate"</span><span class="tag">&gt;</span><span class="pln">
    Hi! My name is
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;</span><span class="pln">
    </span><b><span class="tag">&lt;content&gt;&lt;/content&gt;</span></b><span class="pln">
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="unchanged"><span class="tag">&lt;/template&gt;</span></span>
</pre>

<p>
shadow host (projected) <code>&lt;content&gt;</code> 
</p>

<p>

</p>

<pre class="prettyprint"><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#nameTag'</span><span class="pun">).</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Shellie'</span><span class="pun">;</span></pre>

<p>
<b></b> <code>&lt;content&gt;</code> 
</p>

<div id="ex2b">

<p> Shadow DOM </p>

<div id="ex2bNameTag">Bob</div>

<p>
<label for="ex2bNewName"></label>
<input name="ex2bNewName" value="Shellie">
<button onclick="updateClicked('#ex2bNameTag', 'input[name=ex2bNewName]');"></button>
</p>

<script>
function updateClicked(nameTagSelector, textBoxSelector) {
  var text = document.querySelector(textBoxSelector);
  document.querySelector(nameTagSelector).textContent = text.value;
  text.value = '';
  text.focus();
}
</script>


<script>
(function () {
  if (!window.HTMLTemplateElement ||
      !HTMLElement.prototype.webkitCreateShadowRoot) {
    remove('#ex2b');
    return;
  }

  var shadow = document.querySelector('#ex2bNameTag').webkitCreateShadowRoot();
  var template = document.querySelector('#ex2bNameTagTemplate');
  shadow.appendChild(template.content);
  template.remove();
})();
</script>
</div>


<p>
<b> Shadow DOM </b>

</p>

<h3 id="toc-separation-profit"></h3>

<p>
 <code>&lt;div&gt;</code> 
</p>

<p>

</p>

<p>

</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTag"</span><span class="tag">&gt;</span><span class="pln">Bob</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
 shadow root  shadow root 
</p>

<pre class="prettyprint"><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTagTemplate"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;style&gt;</span><span class="pln">
</span><span class="pun">.</span><span class="pln">outer </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2px</span><span class="pln"> solid pink</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">border-radius</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">url</span><span class="pun">(</span><span class="str">sakura.jpg</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">font-size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20pt</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">text-align</span><span class="pun">:</span><span class="pln"> center</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-family</span><span class="pun">:</span><span class="pln"> sans-serif</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-weight</span><span class="pun">:</span><span class="pln"> bold</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">.</span><span class="pln">name </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">font-size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">45pt</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">font-weight</span><span class="pun">:</span><span class="pln"> normal</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">margin-top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.8em</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">padding-top</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.2em</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"outer"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;content&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  
</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span></pre>

<p>

</p>

<div id="ex3a">

<div id="ex3aNameTag">Bob</div>

<p>
<label for="ex3aNewName"></label>
<input name="ex3aNewName" value="">
<button onclick="updateClicked('#ex3aNameTag', 'input[name=ex3aNewName]');"></button>
</p>



</div>

<script>
(function () {
  if (!window.HTMLTemplateElement ||
      !HTMLElement.prototype.webkitCreateShadowRoot) {
    remove('#ex3a');
    document.write('<img src="SS4.png" alt="A name tag with a watercolor painting of cherry blossoms on it.">');
    return;
  }
  var shadow = document.querySelector('#ex3aNameTag').webkitCreateShadowRoot();
  var template = document.querySelector('#ex3aNameTagTemplate');
  shadow.appendChild(template.content);
  template.remove();
})();
</script>

<p class="small-notice">
<a href="http://www.flickr.com/photos/mikedowman/5621169045/"> Mike Dowman</a>  Creative Commons license 
</p>

<p>
 web <em></em>
<strong></strong> ( Hi! My name is )(  )
</p>

<h2 id="toc-projection"></h2>

<p>
<code>&lt;content&gt;</code>  shadow host 
<span class="attribute">select</span>  content  content 
</p>

<p>

</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"nameTag"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"first"</span><span class="tag">&gt;</span><span class="pln">Bob</span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div&gt;</span><span class="pln">B. Love</span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"email"</span><span class="tag">&gt;</span><span class="pln">bob@</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
shadow root  CSS 
</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> purple</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1em</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><b><span class="atn">select</span><span class="pun">=</span><span class="atv">".first"</span></b><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> yellow</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><b><span class="atn">select</span><span class="pun">=</span><span class="atv">"div"</span></b><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">style</span><span class="pun">=</span><span class="atv">"</span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> blue</span><span class="pun">;</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;content</span><span class="pln"> </span><b><span class="atn">select</span><span class="pun">=</span><span class="atv">".email"</span><span class="tag">&gt;</span></b><span class="tag">&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></pre>

<p class="notice"><b></b> <span class="attribute">select</span>  host ( <code>select="table tr"</code>)</p>

<p>
<code>&lt;div class="email"&gt;</code>  <code>&lt;content select="div"&gt;</code>  <code>&lt;content
select=".email"&gt;</code>  Bob 
</p>

<div id="ex4a">

<div id="ex4aNameTag">
  <div class="first">Bob</div>
  <div>B. Love</div>
  <div class="email">bob@</div>
</div>


</div>

<script>
(function () {
  if (!window.HTMLTemplateElement ||
      !HTMLElement.prototype.webkitCreateShadowRoot) {
    remove('#ex4a');
    document.write('<img src="SS5.png" alt="The rendered result. Bobs email appears in yellow." id="ex4a">');
    return;
  }
  var shadow = document.querySelector('#ex4aNameTag').webkitCreateShadowRoot();
  var template = document.querySelector('#ex4aNameTagTemplate');
  shadow.appendChild(template.content);
  template.remove();
})();
</script>

<p>
Bob 
</p>

<p>
 Shadow DOM 
<strong>content  Shadow DOM </strong>
( <span class="attribute">select</span> )
()
</p>

<p>
<code>&lt;div class="email"&gt;</code>  <code>div</code>  <code>.email</code>  <code>div</code>  content 
<code>&lt;div class="email"&gt;</code> 
</p>

<p>
<em></em> Hello, world 
 JavaScript  Shadow DOM 
</p>

<p>
HTML  <code>&lt;input
type="date"&gt;</code> <i></i>
()
</p>

<pre class="prettyprint"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"dateRangePicker"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"start"</span><span class="tag">&gt;</span><span class="pln">Start:</span><span class="tag">&lt;/label&gt;</span><span class="pln">
  </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"date"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"startDate"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"start"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;br&gt;</span><span class="pln">
  </span><span class="tag">&lt;label</span><span class="pln"> </span><span class="atn">for</span><span class="pun">=</span><span class="atv">"end"</span><span class="tag">&gt;</span><span class="pln">End:</span><span class="tag">&lt;/label&gt;</span><span class="pln">
  </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"date"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"endDate"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"end"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></pre>

<p>
 Shadow DOM

</p>

<p>
 label 
 Shadow DOM 

</p>

<div class="dateRangePicker">
  <label for="start">Start:</label>
  <input type="date" name="startDate" id="start">
  <br>
  <label for="end">End:</label>
  <input type="date" name="endDate" id="end">
</div>

<h2 id="toc-conclusion"> Shadow DOM 101</h2>

<p>
 Shadow DOM  Shadow DOM 101
 Shadow DOM  shadow host  shadow DOM
 shadow DOM Model-Driven Views (MDV)  Shadow DOM 
 Web  Shadow DOM Web  Shadow DOM
</p>

<p>
<a href="https://plus.google.com/103330502635338602217/posts">Google+  Web </a>
</p>

<p class="small-notice">
 <a href="http://Robing.github.io/profiles/#ericbidelman">Eric Bidelman</a>Darin
FisherDimitri GlazkovAlex KomoroskeAlex Russell <a href="http://Robing.github.io/profiles/#paulirish">Paul Irish</a> 
</p>


      </div>

]]></content>
  </entry>
  
</feed>
